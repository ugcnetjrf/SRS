// --- Helper to get current date in YYYY-MM-DD format
function getCurrentDate() {
  const d = new Date();
  return d.toISOString().split('T')[0];
}

// --- Load tasks from localStorage
function loadTasks() {
  return JSON.parse(localStorage.getItem('tasks')) || {};
}

// --- Save tasks to localStorage
function saveTasks(tasks) {
  localStorage.setItem('tasks', JSON.stringify(tasks));
}

// --- Render tasks grouped by date
function displayTasks() {
  const container = document.getElementById('task-container');
  container.innerHTML = '';

  const tasks = loadTasks();
  const dates = Object.keys(tasks).sort().reverse();

  for (const date of dates) {
    const section = document.createElement('div');
    section.classList.add('date-header');
    section.textContent = date;
    container.appendChild(section);

    const taskList = document.createElement('div');
    taskList.classList.add('task-list');

    tasks[date].forEach((task, index) => {
      const item = document.createElement('div');
      item.className = 'task-item';
      if (task.done) item.classList.add('completed');
      item.textContent = task.text;

      // Show full content when clicked
      item.addEventListener('click', () => {
        alert(`Task: ${task.text}\nDate: ${date}`);
      });

      // Toggle done/undone on swipe or double click
      item.addEventListener('dblclick', () => {
        task.done = !task.done;
        saveTasks(tasks);
        displayTasks();
      });

      taskList.appendChild(item);
    });

    container.appendChild(taskList);
  }
}

// --- Add new task
document.getElementById('add-task').addEventListener('click', () => {
  const taskInput = document.getElementById('task-input');
  const dateInput = document.getElementById('task-date');
  const taskText = taskInput.value.trim();
  const selectedDate = dateInput.value || getCurrentDate();

  if (!taskText) return;

  const tasks = loadTasks();
  if (!tasks[selectedDate]) tasks[selectedDate] = [];
  tasks[selectedDate].push({ text: taskText, done: false });

  saveTasks(tasks);
  taskInput.value = '';
  displayTasks();
});

// --- Set default date in date input to today
document.getElementById('task-date').value = getCurrentDate();

// --- Initial render
displayTasks();
